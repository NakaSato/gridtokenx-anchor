\documentclass[conference,10pt]{IEEEtran}
\usepackage{cite}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{algorithmic}
\usepackage{graphicx}
\usepackage{textcomp}
\usepackage{xcolor}
\usepackage{hyperref}
\usepackage{booktabs}
\usepackage{listings}
\usepackage{setspace}
\usepackage{tikz}
\usetikzlibrary{shapes,arrows,positioning,calc}

% Code Listing Setup
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinelanguage{Rust}{
    keywords={true,false,let,mut,if,else,while,for,loop,match,return,break,continue,pub,fn,struct,enum,impl,trait,type,mod,use,crate,extern,const,static,unsafe,async,await,move,ref,box,self,Self,super,where,in,as,dyn,abstract,become,do,final,macro,override,priv,try,typeof,unsized,virtual,yield},
    keywordstyle=\color{magenta},
    ndkeywords={u8,u16,u32,u64,u128,i8,i16,i32,i64,i128,f32,f64,bool,char,str,String,Vec,Option,Result,Box,Rc,Arc,Cell,RefCell,HashMap,BTreeMap,HashSet,BTreeSet,LinkedList,VecDeque,BinaryHeap,Duration,Instant,SystemTime,Path,PathBuf,File,OpenOptions,Read,Write,BufRead,BufReader,BufWriter,Stdin,Stdout,Stderr,Command,Child,ExitStatus,OsString,OsStr,CString,CStr,Mutex,RwLock,Condvar,Barrier,Once,Thread,Builder,JoinHandle,LocalKey,AtomicBool,AtomicIsize,AtomicUsize,AtomicPtr},
    ndkeywordstyle=\color{codepurple},
    sensitive=true,
    comment=[l]{//},
    morecomment=[s]{/*}{*/},
    commentstyle=\color{codegreen},
    stringstyle=\color{codepurple},
    morestring=[b]",
}

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=2
}
\lstset{style=mystyle}

% For Thai language support with XeLaTeX
\usepackage{fontspec}
\usepackage{polyglossia}
\setdefaultlanguage{thai}
\setotherlanguage{english}

% Use TH Sarabun New font (installed in user fonts)
\defaultfontfeatures{Ligatures=TeX}
\setmainfont{THSarabunNew}[
    Path = /Users/chanthawat/Library/Fonts/,
    Extension = .ttf,
    UprightFont = THSarabunNew,
    BoldFont = THSarabunNew Bold,
    ItalicFont = THSarabunNew Italic,
    BoldItalicFont = THSarabunNew BoldItalic,
    Scale = 1.3,
    LetterSpace = 0.5
]

% Use same font for sans-serif and monospace to avoid polyglossia warnings
\setsansfont{THSarabunNew}[
    Path = /Users/chanthawat/Library/Fonts/,
    Extension = .ttf,
    Scale = 1.3
]
\setmonofont{THSarabunNew}[
    Path = /Users/chanthawat/Library/Fonts/,
    Extension = .ttf,
    Scale = 1.3
]

% Adjust line spacing for Thai text readability  
\linespread{1.15}

% Thai line breaking configuration
\XeTeXlinebreaklocale "th"
\XeTeXlinebreakskip = 0pt plus 3pt minus 1pt
\XeTeXlinebreakpenalty = 0

% Better paragraph spacing
\setlength{\parskip}{0.5ex plus 0.2ex minus 0.1ex}

% Fix underfull/overfull box warnings
\tolerance=1000
\emergencystretch=3em
\hfuzz=0.5pt
\vfuzz=0.5pt

\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}

\begin{document}
\sloppy

\title{การพัฒนาระบบจำลองการซื้อขายพลังงานแสงอาทิตย์แบบ Peer-to-Peer โดยใช้ Solana Smart Contract\\
\large (Anchor Framework ในสภาพแวดล้อมแบบ Permissioned)}

\author{\IEEEauthorblockN{นายจันทร์ธวัฒ กิริยาดี}
\IEEEauthorblockA{\textit{คณะวิศวกรรมศาสตร์} \\
\textit{สาขาวิศวกรรมคอมพิวเตอร์และปัญญาประดิษฐ์}\\
\textit{มหาวิทยาลัยหอการค้าไทย}\\
กรุงเทพมหานคร ประเทศไทย \\
2410717302003@live4.utcc.ac.th}
}

\maketitle

\begin{abstract}
บทความนี้นำเสนอการประเมินประสิทธิภาพอย่างครอบคลุมของ GridTokenX ซึ่งเป็นแพลตฟอร์มการซื้อขายพลังงานแบบ Peer-to-Peer (P2P) แบบกระจายศูนย์ที่พัฒนาบน Solana Cluster แบบส่วนตัว (Private Cluster) งานวิจัยนี้ใช้วิธีการ BLOCKBENCH (SIGMOD 2017) สำหรับการวิเคราะห์ระบบทีละชั้นอย่างเป็นระบบ ร่วมกับการประยุกต์ใช้ TPC-C Benchmark เพื่อประเมินการรองรับภาระงานในสถานการณ์จริง ผลการทดลองยืนยันประสิทธิภาพของระบบด้วยค่า \textbf{2,111 tpmC} (Transactions Per Minute Type C) และมีความหน่วงเฉลี่ยเพียง 116 ms ซึ่งเหมาะสมสำหรับการใช้งานจริง การวิเคราะห์ด้วย BLOCKBENCH แสดงให้เห็นว่าสถาปัตยกรรมแบบขนานของ Solana ช่วยขจัดคอขวดในการประมวลผล โดยสามารถรองรับได้ถึง 231 TPS ในชั้น Execution นอกจากนี้ งานวิจัยยังนำเสนอแนวคิด "Trust Premium" (58.28 เท่า) เพื่อเปรียบเทียบต้นทุนด้านประสิทธิภาพกับระบบรวมศูนย์ (PostgreSQL) พร้อมทั้งอธิบายการปรับปรุงประสิทธิภาพระดับล่าง (Low-level Optimizations) ได้แก่ การคำนวณด้วยเลขจำนวนเต็มเท่านั้น (Integer-only Arithmetic) และการอัปเดตสถานะแบบ Lazy Update ซึ่งช่วยเพิ่มปริมาณงานโดยยังคงรักษาความถูกต้องทางคณิตศาสตร์อย่างเคร่งครัดเพื่อการอนุรักษ์พลังงาน
\end{abstract}

\begin{IEEEkeywords}
บล็อกเชน, การซื้อขายพลังงาน, Solana, TPC-C, BLOCKBENCH, YCSB, การทดสอบประสิทธิภาพ, Smart Contracts
\end{IEEEkeywords}

\section{บทนำ}
การกระจายศูนย์ระบบพลังงานผ่านทรัพยากรพลังงานแบบกระจาย (Distributed Energy Resources หรือ DERs) จำเป็นต้องมีโครงสร้างพื้นฐานการซื้อขายที่แข็งแกร่ง ซึ่งสามารถรองรับธุรกรรมขนาดเล็กที่มีความถี่สูงได้ \cite{b2} รูปแบบสาธารณูปโภคแบบรวมศูนย์ดั้งเดิมมักประสบปัญหาความเสี่ยงจากการล้มเหลวที่จุดเดียว (Single Point of Failure) และขาดความโปร่งใสในการกำหนดราคา เทคโนโลยีบล็อกเชนนำเสนอทางออกสำหรับปัญหานี้ แต่มักถูกวิพากษ์วิจารณ์เรื่องข้อจำกัดด้านความสามารถในการขยายระบบ (Scalability) \cite{b4}

งานวิจัยนี้ประเมินประสิทธิภาพของ GridTokenX ซึ่งใช้ประโยชน์จาก Sealevel Parallel Runtime ของ Solana \cite{b3} เพื่อแก้ไขปัญหาคอขวดเหล่านี้ ซึ่งแตกต่างจากบล็อกเชนรุ่นก่อนหน้า โดย Solana นำเสนอความแน่นอนของสถานะสุดท้าย (Deterministic Finality) ในโหมด Permissioned และความสามารถในการประมวลผลธุรกรรมที่ไม่ทับซ้อนกันในรูปแบบขนาน ซึ่งเหมาะสมอย่างยิ่งสำหรับการซื้อขายพลังงานที่มีปริมาณธุรกรรมสูง วัตถุประสงค์ของการศึกษานี้คือ:
\begin{enumerate}
    \item เพื่อศึกษาและนำเสนอสถาปัตยกรรมของระบบจำลองการซื้อขายพลังงาน P2P โดยใช้ Solana (Anchor) ในสภาพแวดล้อมแบบ Permissioned (PoA)
    \item เพื่อพัฒนาและพิสูจน์แนวคิด (Proof-of-Concept) ของระบบต้นแบบที่สามารถจำลองการแลกเปลี่ยน GRID Token โดยใช้ AMI Simulator
    \item เพื่อประเมินและวิเคราะห์ประสิทธิภาพโดยใช้การวิเคราะห์ตามลำดับชั้นด้วย BLOCKBENCH และชุดการทดสอบ TPC Benchmark
\end{enumerate}

\section{งานวิจัยที่เกี่ยวข้อง: วิธีการ BLOCKBENCH}
BLOCKBENCH \cite{b4} นำเสนอกรอบการทำงานอย่างเป็นระบบสำหรับการประเมินประสิทธิภาพบล็อกเชนส่วนตัว (Private Blockchain) ผ่านสถาปัตยกรรม 4 ชั้น ได้แก่:

\begin{enumerate}
    \item \textbf{Consensus Layer}: วัดค่าใช้จ่ายของกระบวนการฉันทามติ (Consensus Overhead) ผ่านการทำงานแบบ DoNothing
    \item \textbf{Execution Layer}: ประเมินการประมวลผล Smart Contract ผ่านภาระงานที่ใช้หน่วยประมวลผลสูง (CPU-intensive)
    \item \textbf{Data Model Layer}: ทดสอบประสิทธิภาพการอ่าน/เขียนสถานะโดยใช้ IOHeavy Benchmarks
    \item \textbf{Application Layer}: การจำลองภาระงานในสถานการณ์จริงโดยใช้ YCSB และ Smallbank
\end{enumerate}

งานวิจัยนี้ได้ขยายวิธีการของ BLOCKBENCH ไปยัง Solana/Anchor ด้วยการพัฒนา Benchmark แต่ละหมวดหมู่ด้วยภาษา Rust แบบเนทีฟ (Native Rust Implementation)

งานวิจัยก่อนหน้านี้ได้สำรวจการประยุกต์ใช้บล็อกเชนสำหรับการซื้อขายพลังงาน เช่น โครงการ Brooklyn Microgrid \cite{b2} และโครงการที่พัฒนาบน Ethereum หรือ Hyperledger Fabric \cite{b5, b6} อย่างไรก็ตาม ระบบเหล่านี้มักเผชิญกับข้อจำกัดด้านความสามารถในการขยายระบบ (Scalability) และความหน่วงที่สูงเมื่อปริมาณธุรกรรมเพิ่มขึ้น งานวิจัยนี้นำเสนอทางเลือกใหม่โดยอาศัยสถาปัตยกรรมประสิทธิภาพสูงของ Solana

\section{สถาปัตยกรรมระบบ}
แพลตฟอร์มถูกพัฒนาขึ้นในรูปแบบชุดของ Anchor Smart Contracts จำนวน 5 สัญญา ที่เชื่อมต่อกันบนเครือข่าย Solana โดยอาศัย Program Derived Addresses (PDAs) เพื่อบริหารจัดการสิทธิ์การเข้าถึงข้อมูลอย่างปลอดภัยและเป็นระบบ ประกอบด้วย:
1. \textbf{Registry}: จัดการข้อมูลอัตลักษณ์ผู้ใช้และสินทรัพย์ประเภทมิเตอร์
2. \textbf{Oracle}: ตรวจสอบความถูกต้องของข้อมูลจากเซ็นเซอร์ภายนอกเครือข่าย (Off-chain Sensors)
3. \textbf{Energy Token}: โทเค็นมาตรฐาน SPL ซึ่งแทนค่าพลังงาน 1 kWh
4. \textbf{Trading}: ระบบสมุดคำสั่งซื้อขาย (Order Book) และกลไกการชำระราคา (Settlement Engine)
5. \textbf{Governance}: การตั้งค่าระบบและพารามิเตอร์ของ DAO

\section{ระเบียบวิธีวิจัย}

\subsection{การเทียบเคียง TPC-C (TPC-C Mapping)}
งานวิจัยนี้ได้ทำการเทียบเคียงธุรกรรมมาตรฐาน TPC-C \cite{b1} กับธุรกรรมการซื้อขายพลังงานที่เทียบเท่ากัน เพื่อสร้างโปรไฟล์ภาระงานที่มีความสมจริง ค่า tpmC (Transactions Per Minute Type C) คำนวณจากจำนวนธุรกรรมคำสั่งซื้อใหม่ (New-Order) ที่สำเร็จต่อนาที:
\begin{equation}
tpmC = \frac{Total\_New\_Orders}{Duration\_Minutes}
\end{equation}

\begin{table}[t!]
\caption{การเทียบเคียง TPC-C กับการซื้อขายพลังงาน}
\begin{center}
\begin{tabular}{lcl}
\toprule
\textbf{ธุรกรรม TPC-C} & \textbf{สัดส่วน} & \textbf{ฟังก์ชัน GridTokenX} \\
\midrule
New Order & 45\% & \texttt{create\_sell\_order} / \texttt{create\_buy\_order} \\
Payment & 43\% & \texttt{transfer\_tokens} (การชำระราคา) \\
Order Status & 4\% & \texttt{get\_order\_status} (RPC Read) \\
Delivery & 4\% & \texttt{match\_orders} (การทำงานแบบ Batch) \\
Stock Level & 4\% & \texttt{get\_balance} (การตรวจสอบพลังงาน) \\
\bottomrule
\end{tabular}
\label{tab:tpcc-mapping}
\end{center}
\end{table}

\subsection{แบบจำลองทางคณิตศาสตร์}

\subsubsection{กลไกการกำหนดราคา VWAP}
เพื่อให้มั่นใจว่าราคาตลาดมีความยุติธรรม แพลตฟอร์มใช้อัลกอริทึมการค้นหาราคาเฉลี่ยถ่วงน้ำหนักตามปริมาณ (Volume-Weighted Average Price: VWAP) โดยราคาดุลยภาพ (Clearing Price) $P_{clearing}$ จะถูกคำนวณแบบไดนามิกดังนี้:

\begin{equation}
P_{base} = \frac{P_{bid} + P_{ask}}{2}
\end{equation}

\begin{equation}
P_{clearing} = P_{base} + \left( P_{base} \times \min\left(\frac{V_{trade}}{V_{total}}, 1.0\right) \times \delta_{max} \right)
\end{equation}

โดยที่ $V_{trade}$ คือปริมาณการจับคู่ปัจจุบัน, $V_{total}$ คือปริมาณรวมในอดีต และ $\delta_{max}$ คือค่าสัมประสิทธิ์ความยืดหยุ่นของราคาสูงสุด (10\%)

\subsubsection{กฎการอนุรักษ์โทเค็น}
ระบบบังคับใช้กฎการอนุรักษ์พลังงานอย่างเคร่งครัด โดยโทเค็น ($\Delta Supply_{GRID}$) จะสามารถสร้างขึ้นได้ก็ต่อเมื่อพลังงานที่ผลิตจริงทางกายภาพได้รับการชำระบัญชีทางคณิตศาสตร์แล้วเท่านั้น:

\begin{equation}
\Delta Supply_{GRID} = \max(0, (E_{produced} - E_{consumed}) - E_{settled})
\end{equation}

\subsubsection{การปรับปรุงประสิทธิภาพระบบ}
เพื่อเพิ่มปริมาณงานสูงสุดภายใต้ขีดจำกัด Compute Unit (CU) ของ Solana เราได้ดำเนินการปรับปรุงประสิทธิภาพที่สำคัญ 3 ประการ:

\textbf{A. การคำนวณด้วยเลขจำนวนเต็มเท่านั้น (Integer-only Arithmetic):} 
การดำเนินการเลขทศนิยม (\texttt{f64}) ใช้ทรัพยากรการคำนวณสูงและไม่แนะนำให้ใช้ในโปรแกรม Solana เราจึงแทนที่การคำนวณ VWAP ด้วยระบบเลขจำนวนเต็มแบบจุดคงที่ (Fixed-point Arithmetic):
\begin{equation}
W = \min\left(\frac{V \times 1000}{V_{total}}, 1000\right)
\end{equation}
การปรับลดนี้ช่วยประหยัดทรัพยากรได้ประมาณ 10,000 CUs ต่อการทำธุรกรรม

\textbf{B. การอัปเดตสถานะแบบ Lazy Update:}
แทนที่จะทำการ Serialize อาร์เรย์ประวัติราคาทั้งหมด (มากกว่า 100 รายการ) ในทุกธุรกรรม ระบบจะทำการบันทึกข้อมูลแบบ "Lazy Commit" เฉพาะเมื่อค่าความเบี่ยงเบนของราคาเกิน 5\% หรือทุกๆ 60 วินาที ซึ่งช่วยลดภาระงานในการทำ Serialization ลงได้ถึง 90\%

\textbf{C. การจับคู่คำสั่งแบบ Batch:}
คำสั่ง \texttt{match\_orders} ถูกปรับโครงสร้างโค้ด (Refactor) เพื่อรองรับการทำงานแบบ Batch ทำให้สามารถชำระ Limit Orders หลายรายการที่ไม่ทับซ้อนกันได้ภายในธุรกรรมเดียวแบบอะตอมิก ซึ่งช่วยปรับปรุงอัตรา "Fills Per Second" ได้อย่างมีนัยสำคัญ

\section{การตั้งค่าการทดลอง}
การทดสอบ Benchmark ดำเนินการบน Solana Localnet Cluster ประสิทธิภาพสูง (Single Node Setup) เพื่อวัดประสิทธิภาพสูงสุดของ Validator Node เดียวโดยปราศจากปัจจัยความหน่วงจากเครือข่ายภายนอก
\begin{itemize}
    \item \textbf{ฮาร์ดแวร์}: Apple M-Series (8-core), 16GB RAM
    \item \textbf{Cluster}: Solana Test Validator v1.18
    \item \textbf{Client}: โปรแกรมสร้างภาระงานด้วยภาษา Rust แบบ Multi-threaded
    \item \textbf{Baseline}: PostgreSQL 14 รันบนฮาร์ดแวร์เดียวกันสำหรับการเปรียบเทียบ Trust Premium
\end{itemize}

\section{การประเมินประสิทธิภาพ}

\subsection{การวิเคราะห์ชั้น BLOCKBENCH}
ตามวิธีการ BLOCKBENCH เราประเมินแต่ละชั้นสถาปัตยกรรมอย่างอิสระ:

\begin{table}[t!]
\caption{ผลลัพธ์ BLOCKBENCH Micro-benchmark}
\begin{center}
\begin{tabular}{|l|l|r|r|}
\hline
\textbf{ชั้น} & \textbf{Benchmark} & \textbf{TPS} & \textbf{ความหน่วง} \\
\hline
Consensus & DoNothing & 225 & 2.5ms \\
Execution & CPUHeavy-Sort & 231 & 2.5ms \\
Data Model & IOHeavy-Write & 192 & 3.0ms \\
Data Model & IOHeavy-Mixed & 192 & 3.0ms \\
\hline
\end{tabular}
\label{tab:blockbench}
\end{center}
\end{table}

ตัวเลข TPS เหล่านี้ถูกจำกัดโดยประสิทธิภาพของ Client ในการลงนามและส่งธุรกรรมในสภาพแวดล้อมการทดสอบ ไม่ใช่ขีดจำกัดสูงสุดของ Solana Runtime อย่างไรก็ตาม ผลลัพธ์แสดงให้เห็นถึงความสม่ำเสมอของการประมวลผล

DoNothing Benchmark วัดค่าใช้จ่ายของกระบวนการฉันทามติ (225 TPS) ในขณะที่การดำเนินการ CPUHeavy Sorting ทำได้ 231 TPS แสดงถึงประสิทธิภาพการทำงานของ Smart Contract ส่วน IOHeavy Benchmarks ที่ 192 TPS แสดงถึงภาระงานจากการทำ State Serialization

\subsection{ผลลัพธ์ YCSB Workload}
เราใช้โปรไฟล์ YCSB Workload 3 รูปแบบ เพื่อประเมินประสิทธิภาพในชั้น Application Layer:

\begin{table}[t!]
\caption{ประสิทธิภาพ YCSB Workload}
\begin{center}
\begin{tabular}{|l|l|r|r|}
\hline
\textbf{Workload} & \textbf{โปรไฟล์} & \textbf{ops/s} & \textbf{ความหน่วง} \\
\hline
YCSB-A & 50\% อ่าน, 50\% อัปเดต & 290 & 2.7ms \\
YCSB-B & 95\% อ่าน, 5\% อัปเดต & 442 & 1.8ms \\
YCSB-C & 100\% อ่าน & 391 & 2.1ms \\
\hline
\end{tabular}
\label{tab:ycsb}
\end{center}
\end{table}

Smallbank OLTP Benchmark ทำได้ \textbf{1,714 TPS} โดยมีความหน่วงเฉลี่ย 5.83 ms แสดงถึงประสิทธิภาพที่แข็งแกร่งสำหรับภาระงานด้านธุรกรรมทางการเงิน

\subsection{การวิเคราะห์ปริมาณงาน TPC-C}
การใช้งาน TPC-C Benchmark ของเราทำได้ปริมาณงาน \textbf{2,111 tpmC} (76.85 TPS) ในโหมดการจำลอง ปริมาณงานนี้เกิดจาก \textit{Sealevel} Parallel Runtime โดยตรง ซึ่งอนุญาตให้ธุรกรรมที่ไม่ทับซ้อนกัน (เช่น การซื้อขายระหว่างคู่ผู้ใช้ที่ต่างกัน) ทำงานพร้อมกันได้ ในขณะที่บล็อกเชนแบบ EVM ดั้งเดิม ธุรกรรมเหล่านี้จะถูกจัดลำดับ (Serialize) ทำให้เกิดคอขวด

ในการรัน Benchmark ของเรา มีธุรกรรมทั้งหมด 4,621 รายการถูกประมวลผล โดยสำเร็จ 4,611 รายการ (\textbf{อัตราสำเร็จ 99.78\%}) สัดส่วนประเภทธุรกรรมเป็นไปตามข้อกำหนด TPC-C:
\begin{itemize}
    \item New-Order: 2,074 ธุรกรรม (44.9\%) -- สำเร็จ 99.71\%
    \item Payment: 2,004 ธุรกรรม (43.4\%) -- สำเร็จ 99.80\%
    \item Order-Status: 197 ธุรกรรม (4.3\%) -- สำเร็จ 100\%
    \item Delivery: 175 ธุรกรรม (3.8\%) -- สำเร็จ 100\%
    \item Stock-Level: 171 ธุรกรรม (3.7\%) -- สำเร็จ 100\%
\end{itemize}

สำหรับตลาด P2P ระดับภูมิภาคที่มี 10,000 ครัวเรือน สมมติว่าสมาร์ทมิเตอร์แต่ละตัวส่งค่าทุก 15 นาที ปริมาณงานที่ต้องการจะอยู่ที่ประมาณ 11 TPS ซึ่งค่า 76.85 TPS ที่วัดได้นั้นให้ \textbf{ส่วนเผื่อความปลอดภัยถึง 7 เท่า} พิสูจน์ว่าสถาปัตยกรรมสามารถรองรับการติดตั้งใช้งานในระดับละแวกบ้านได้โดยไม่เกิดปัญหาความแออัด

\subsection{ผลลัพธ์ TPC-E และ TPC-H}
เราขยายการประเมินเพื่อรวม TPC-E (ภาระงานธุรกิจหลักทรัพย์) และ TPC-H (ระบบสนับสนุนการตัดสินใจ) Benchmarks:

\begin{table}[t!]
\caption{ผลลัพธ์ TPC-E/TPC-H Benchmark}
\begin{center}
\begin{tabular}{|l|r|r|r|}
\hline
\textbf{Benchmark} & \textbf{เมตริกหลัก} & \textbf{ความหน่วงเฉลี่ย} & \textbf{p99} \\
\hline
TPC-E & 306 tpsE & 7.89 ms & 17 ms \\
TPC-H & 250,486 QphH & 71.0 ms & 147 ms \\
\hline
\end{tabular}
\label{tab:tpce-tpch}
\end{center}
\end{table}

TPC-E Benchmark ทำได้ \textbf{306 tpsE} (Trades Per Second) แสดงประสิทธิภาพที่แข็งแกร่งสำหรับภาระงานแบบนายหน้าที่มีการจับคู่คำสั่งที่ซับซ้อน ส่วน TPC-H Analytical Queries ทำได้ \textbf{250,486 QphH} (Queries Per Hour) ยืนยันความสามารถของแพลตฟอร์มสำหรับฟังก์ชันการรายงานและการตรวจสอบ

\subsection{การวิเคราะห์ความหน่วง}
ความหน่วงของธุรกรรมแตกต่างอย่างมากจาก "เวลาในการยืนยันธุรกรรม" ในสภาพแวดล้อม PoA แบบ Permissioned นี้
\begin{enumerate}
    \item \textbf{ความหน่วงเฉลี่ย (116.56 ms)}: แทนเวลาเฉลี่ยสำหรับ Leader Node ในการประมวลผลคำสั่งและอัปเดตสถานะในหน่วยความจำ
    \item \textbf{ความหน่วง p50 (112.57 ms)}: เวลาประมวลผลธุรกรรมค่ามัธยฐาน
    \item \textbf{ความหน่วง p95 (180.04 ms)}: ที่เปอร์เซ็นไทล์ที่ 95 ภายใต้โหลดปกติ
    \item \textbf{ความหน่วง p99 (215.54 ms)}: แทนเวลาประมวลผลในกรณีที่แย่ที่สุดภายใต้โหลดหนัก
\end{enumerate}

โหมดการจำลองรวม "Think Time" ตามมาตรฐาน TPC-C เพื่อจำลองพฤติกรรมผู้ใช้จริง ในสภาพแวดล้อม PoA ระดับการผลิต (Production) ที่มี Validators ที่ได้รับการปรับปรุง ความหน่วงคาดว่าจะต่ำกว่านี้อย่างมีนัยสำคัญ ซึ่งแตกต่างจาก Mainnets สาธารณะที่ Finality อาจใช้เวลาหลายวินาที ธรรมชาติแบบ Permissioned ของ GridTokenX Cluster ช่วยให้มีความแน่นอนของสถานะสุดท้าย (Deterministic Finality)

\subsection{การวิเคราะห์ Concurrency}
ภายใต้สภาวะการแข่งขันสูง (หลายคำสั่งต่อสถานะตลาดเดียวกัน) Sealevel Runtime สามารถจัดลำดับธุรกรรมที่ขัดแย้งกันให้เป็นเส้นตรง (Linearize) ได้อย่างมีประสิทธิภาพ ในขณะที่ประมวลผลคำขอที่ไม่ทับซ้อนกันในรูปแบบขนาน อัตราความขัดแย้ง MVCC (Multi-Version Concurrency Control) ที่สังเกตได้คือ \textbf{1.45\%} ซึ่งส่วนใหญ่เกิดจากธรรมชาติแบบอะตอมิกของคำสั่ง \texttt{match\_orders} จำนวนครั้งการลองใหม่เฉลี่ยคือ 0.02 แสดงถึงประสิทธิภาพในการจัดการความขัดแย้ง

\subsection{การวิเคราะห์ความสามารถในการขยายตัว}
เราทำการทดสอบความสามารถในการขยายตัวใน 3 มิติ:

\begin{table}[t!]
\caption{ผลลัพธ์การทดสอบความสามารถในการขยายตัว}
\begin{center}
\begin{tabular}{|l|r|r|r|}
\hline
\textbf{การทดสอบ} & \textbf{TPS} & \textbf{ความหน่วง} & \textbf{ความเสถียร} \\
\hline
1 thread (baseline) & 443 & 2.26ms & 100\% \\
32 concurrent threads & 398 & 2.51ms & คงไว้ 90\% \\
60s sustained load & 416 & 2.40ms & เสถียร \\
1,000 accounts & 220 & 4.54ms & ลดลงในลักษณะเชิงเส้น \\
\hline
\end{tabular}
\label{tab:scalability}
\end{center}
\end{table}

\subsection{การเปรียบเทียบข้ามแพลตฟอร์ม}
เราเปรียบเทียบประสิทธิภาพของ GridTokenX กับผลลัพธ์ที่เผยแพร่จากแพลตฟอร์มบล็อกเชนอื่น ดังแสดงในตารางที่ \ref{tab:comparison} และรูปที่ \ref{fig:comparison}:

\begin{table}[t!]
\caption{การเปรียบเทียบประสิทธิภาพแพลตฟอร์ม}
\begin{center}
\resizebox{\columnwidth}{!}{
\begin{tabular}{|l|l|r|r|r|}
\hline
\textbf{แพลตฟอร์ม} & \textbf{Benchmark} & \textbf{TPS} & \textbf{ความหน่วง} & \textbf{แหล่งที่มา} \\
\hline
GridTokenX & Smallbank & 1,714 & 5.8ms & การศึกษานี้ \\
GridTokenX & DoNothing & 225 & 2.5ms & การศึกษานี้ \\
GridTokenX & YCSB-B & 442 & 1.8ms & การศึกษานี้ \\
\hline
Hyperledger 2.0 & Smallbank & 400 & 150ms & BLOCKBENCH \\
Hyperledger 2.0 & DoNothing & 3,500 & 45ms & BLOCKBENCH \\
Hyperledger 2.0 & YCSB & 200 & 200ms & BLOCKBENCH \\
\hline
Ethereum & DoNothing & 15 & 13,000ms & BLOCKBENCH \\
Parity & DoNothing & 140 & 650ms & BLOCKBENCH \\
\hline
\end{tabular}
}
\label{tab:comparison}
\end{center}
\end{table}

\begin{figure}[t!]
\centering
\begin{tikzpicture}
    % Axes
    \draw[thick,->] (0,0) -- (7,0);
    \draw[thick,->] (0,0) -- (0,4.5);
    \node[rotate=90] at (-1, 2.25) {TPS (Log Scale)};
    
    % Grid lines
    \foreach \y/\label in {1.4/10, 2.8/100, 4.2/1000}
        \draw[gray!30, dashed] (0,\y) -- (7,\y) node[anchor=east] at (0,\y) {\label};

    % Bars (Log10 values scaled: 1.2cm per decade)
    % Eth: 1.17 * 1.2 = 1.4
    % Fab: 2.60 * 1.2 = 3.12
    % Grid: 3.23 * 1.2 = 3.87
    
    \fill[gray!70] (1,0) rectangle (2,1.4);
    \node[above] at (1.5,1.4) {15};
    \node[below] at (1.5,0) {Ethereum};
    
    \fill[red!70] (3,0) rectangle (4,3.12);
    \node[above] at (3.5,3.12) {400};
    \node[below] at (3.5,0) {Hyperledger};
    
    \fill[blue!70] (5,0) rectangle (6,3.87);
    \node[above] at (5.5,3.87) {\textbf{1,714}};
    \node[below] at (5.5,0) {\textbf{GridTokenX}};
    
    % Title
    \node[anchor=south] at (3.5,4.5) {\textbf{Smallbank Throughput (TPS)}};
\end{tikzpicture}
\caption{การเปรียบเทียบปริมาณงาน (TPS) ระหว่างแพลตฟอร์ม (Log Scale)}
\label{fig:comparison}
\end{figure}

แม้ว่า Hyperledger Fabric จะทำปริมาณงาน DoNothing ได้สูงกว่า (3,500 vs 225 TPS) เนื่องจากสถาปัตยกรรมแบบ Execute-Order-Validate แต่ GridTokenX แสดงให้เห็นถึง \textbf{ประสิทธิภาพ Smallbank ที่ดีกว่า 4.3 เท่า} (1,714 vs 400 TPS) และ \textbf{ความหน่วงต่ำกว่า 26 เท่า} (5.8 ms vs 150 ms) สำหรับภาระงานด้านธุรกรรมทางการเงิน

\subsection{"Trust Premium"}
เรานิยาม "Trust Premium" ว่าเป็นต้นทุนด้านประสิทธิภาพที่ต้องจ่ายเพื่อให้ได้มาซึ่งฉันทามติแบบกระจายศูนย์ (Distributed Consensus) ในเครือข่ายส่วนตัว เมื่อเปรียบเทียบกับเกณฑ์มาตรฐาน (Baseline) ของระบบรวมศูนย์ (PostgreSQL)

\begin{equation}
\begin{split}
\text{Trust Premium} &= \frac{\text{Latency}_{\text{Blockchain}}}{\text{Latency}_{\text{Baseline}}} \\
&= \frac{116.56\text{ ms}}{2.00\text{ ms}} \approx 58.28\times
\end{split}
\end{equation}

แม้ว่าค่านี้จะแสดงถึงความหน่วงที่เพิ่มขึ้นเมื่อเทียบกับฐานข้อมูลแบบรวมศูนย์ แต่ถือว่าเป็นระดับที่ยอมรับได้สำหรับแอปพลิเคชันการซื้อขายพลังงาน ซึ่งในระบบดั้งเดิมกระบวนการชำระราคาอาจใช้เวลาหลายวันหรือหลายสัปดาห์ สิ่งที่ได้รับแลกเปลี่ยนมาคือ:
\begin{itemize}
    \item ร่องรอยการตรวจสอบธุรกรรมที่ไม่สามารถแก้ไขได้ (Immutable Audit Trail)
    \item การชำระราคาอัตโนมัติด้วย Smart Contract
    \item กลไกการกำหนดราคาที่โปร่งใส
    \item การขจัดความเสี่ยงจากการล้มเหลวที่จุดเดียว (Single Point of Failure)
\end{itemize}

\subsection{สรุปผลลัพธ์ Benchmark}
ตารางที่ \ref{tab:benchmark-results} สรุปเมตริกประสิทธิภาพหลักจากการประเมิน Benchmark อย่างครอบคลุมของเรา

\begin{table}[t!]
\caption{สรุปผลลัพธ์ Benchmark อย่างครอบคลุม}
\begin{center}
\begin{tabular}{|l|c|}
\hline
\textbf{เมตริก} & \textbf{ค่า} \\
\hline
\multicolumn{2}{|c|}{\textit{BLOCKBENCH Micro-benchmarks}} \\
\hline
DoNothing (Consensus) & 225 TPS \\
CPUHeavy (Execution) & 231 TPS \\
IOHeavy (Data Model) & 192 TPS \\
\hline
\multicolumn{2}{|c|}{\textit{YCSB/Smallbank}} \\
\hline
YCSB-B (95\% อ่าน) & 442 ops/s \\
Smallbank OLTP & 1,714 TPS \\
\hline
\multicolumn{2}{|c|}{\textit{ชุด TPC Benchmark}} \\
\hline
TPC-C (tpmC) & 2,111 \\
TPC-E (tpsE) & 306 \\
TPC-H (QphH) & 250,486 \\
\hline
\multicolumn{2}{|c|}{\textit{เมตริกประสิทธิภาพ}} \\
\hline
อัตราสำเร็จ & 99.78\% \\
ความหน่วงเฉลี่ย & 116.56 ms \\
ความหน่วง p99 & 215.54 ms \\
อัตราความขัดแย้ง MVCC & 1.45\% \\
Trust Premium & 58.28x \\
\hline
\end{tabular}
\label{tab:benchmark-results}
\end{center}
\end{table}

\section{กรอบการประเมินข้ามแพลตฟอร์ม}
เพื่อเปรียบเทียบ GridTokenX กับแพลตฟอร์มบล็อกเชนอื่นอย่างเข้มงวด (เช่น Ethereum, Hyperledger Fabric) \cite{b4} เราขอเสนอ \textit{Standardized Energy Trading Workload (SETW)} ซึ่งนักวิจัยสามารถทำซ้ำวิธีการนี้ได้โดยปฏิบัติตาม 3 ขั้นตอนดังนี้:

\subsection{การพัฒนา Smart Contract ที่เทียบเท่า}
แพลตฟอร์มเป้าหมายต้องมีการพัฒนาตรรกะหลัก (Core Logic) ตามที่กำหนดในตารางที่ \ref{tab:tpcc-mapping} โดยเฉพาะฟังก์ชัน ``Order Match'' จะต้องมีความเป็นอะตอมิก (Atomic) เพื่อให้มั่นใจว่าการจับคู่คำสั่งและการชำระราคาโทเค็นเกิดขึ้นภายในการเปลี่ยนสถานะทางรหัสวิทยา (Cryptographic State Transition) เดียวกัน

\subsection{โปรไฟล์การป้อนภาระงาน (Workload Injection Profile)}
โปรแกรมสร้างภาระงาน (Load Generator) ต้องรักษาสัดส่วนผสมของธุรกรรมตามมาตรฐาน TPC-C อย่างเคร่งครัด:
\begin{itemize}
    \item \textbf{เน้นการเขียน (Write-heavy 88\%)}: ประกอบด้วย New Orders และ Payments เพื่อทดสอบการแย่งชิงสถานะ (State Contention) ของกลไกฉันทามติ
    \item \textbf{เน้นการอ่าน (Read-light 12\%)}: ประกอบด้วย Status Checks เพื่อทดสอบประสิทธิภาพการสอบถามข้อมูล (RPC Query)
\end{itemize}

\subsection{การปรับฐานเมตริก (Metric Normalization)}
ผลลัพธ์ต้องรายงานในหน่วย \textbf{tpmC} (Transactions Per Minute Type-C) สำหรับบล็อกเชนที่มีความแน่นอนของสถานะสุดท้ายแบบน่าจะเป็น (Probabilistic Finality) เช่น PoW การวัดความหน่วงจะต้องรวมเวลาจนถึงระดับความลึกของการยืนยันบล็อกที่ $k$ (k-block confirmation depth) เพื่อให้สามารถเปรียบเทียบกับตารางเวลาผู้นำแบบกำหนดได้ (Deterministic Leader Schedule) ของ Solana ได้อย่างถูกต้อง

\section{บทสรุป}
GridTokenX แสดงให้เห็นถึงความเป็นไปได้ในการนำเทคโนโลยีบล็อกเชนส่วนตัวมาประยุกต์ใช้กับระบบซื้อขายพลังงาน P2P ในระดับภูมิภาค ผ่านผลการวิเคราะห์ด้วย BLOCKBENCH อย่างครอบคลุมและการประเมินด้วยชุดทดสอบ TPC Benchmark:

\begin{itemize}
    \item \textbf{Consensus Layer}: ปริมาณงาน DoNothing 225 TPS
    \item \textbf{Execution Layer}: การประมวลผล CPUHeavy 231 TPS
    \item \textbf{Data Model}: การดำเนินการสถานะ IOHeavy 192 TPS
    \item \textbf{Application Layer}: Smallbank 1,714 TPS, YCSB-B 442 ops/s
    \item \textbf{ชุด TPC}: 2,111 tpmC, 306 tpsE, 250,486 QphH
\end{itemize}

เมื่อเปรียบเทียบกับ Hyperledger Fabric พบว่า GridTokenX สามารถทำ \textbf{ปริมาณงาน Smallbank ได้สูงกว่า 4.3 เท่า} และมี \textbf{ความหน่วงต่ำกว่า 26 เท่า} สำหรับภาระงานด้านธุรกรรมทางการเงิน ค่า \textbf{Trust Premium ที่ 58.28 เท่า} ที่สังเกตได้ ถือเป็นต้นทุนที่ยอมรับได้แลกกับการได้มาซึ่งร่องรอยการตรวจสอบที่ไม่สามารถแก้ไขได้ การชำระราคาอัตโนมัติด้วย Smart Contract และกลไกการกำหนดราคาที่โปร่งใส

งานในอนาคตจะมุ่งเน้นไปที่: (1) การติดตั้งใช้งานบนกลุ่ม PoA Validator ระดับการผลิต (Production Grade) เพื่อลดความหน่วงให้ต่ำลง (2) การขยายระบบเพื่อรองรับการตั้งค่าคลังข้อมูลขนาดใหญ่ (10+ Warehouses) และ (3) การทดสอบนำร่องในพื้นที่จริง (Real-world Pilot Testing) ด้วยการเชื่อมต่อกับสมาร์ทมิเตอร์


\IEEEtriggeratref{5}
\begin{thebibliography}{00}
\bibitem{b1} Transaction Processing Performance Council (TPC), ``TPC Benchmark C Standard Specification, Revision 5.11,'' 2010.
\bibitem{b2} E. Mengelkamp, J. G{\"a}rttner, K. Rock, S. Kessler, L. Orsini, and C. Weinhardt, ``Designing microgrid energy markets: A case study: The Brooklyn Microgrid,'' \textit{Applied Energy}, vol. 210, pp. 870--880, 2018.
\bibitem{b3} A. Yakovenko, ``Solana: A new architecture for a high performance blockchain v0.8.13,'' Solana Labs Whitepaper, 2018.
\bibitem{b4} T. T. A. Dinh, J. Wang, G. Chen, R. Liu, B. C. Ooi, and K. L. Tan, ``Blockbench: A framework for analyzing private blockchains,'' in \textit{Proc. ACM SIGMOD Int. Conf. Management of Data}, pp. 1085--1100, 2017.
\bibitem{b5} M. Andoni \textit{et al.}, ``Blockchain technology in the energy sector: A systematic review of challenges and opportunities,'' \textit{Renewable and Sustainable Energy Reviews}, vol. 100, pp. 143--174, 2019.
\bibitem{b6} Z. Li, J. Kang, R. Yu, D. Ye, Q. Deng, and Y. Zhang, ``Consortium blockchain for secure energy trading in industrial internet of things,'' \textit{IEEE Trans. Industrial Informatics}, vol. 14, no. 8, pp. 3690--3700, 2018.
\bibitem{b7} J. Guerrero, A. C. Chapman, and G. Verbic, ``Decentralized P2P energy trading under network constraints in a low-voltage network,'' \textit{IEEE Trans. Smart Grid}, vol. 10, no. 5, pp. 5163--5173, 2019.
\bibitem{b8} Anchor Framework Documentation, ``Building Secure Solana Programs,'' Coral, 2023. [Online]. Available: https://anchor-lang.com
\end{thebibliography}

\end{document}
