# Process Flows

## GridTokenX End-to-End Process Documentation

---

## 1. Process Overview

### 1.1 Core Business Processes

```
┌────────────────────────────────────────────────────────────────────────────────────┐
│                         CORE BUSINESS PROCESSES                                    │
└────────────────────────────────────────────────────────────────────────────────────┘


                              ┌─────────────────────┐
                              │                     │
                              │   USER ONBOARDING   │ ◄──── Process 1
                              │                     │
                              └──────────┬──────────┘
                                         │
                                         ▼
                    ┌────────────────────────────────────────┐
                    │                                        │
                    │         ENERGY MANAGEMENT              │ ◄──── Process 2
                    │   (Production → Recording → Minting)   │
                    │                                        │
                    └───────────────────┬────────────────────┘
                                        │
                                        ▼
                              ┌─────────────────────┐
                              │                     │
                              │   MARKETPLACE       │ ◄──── Process 3
                              │   (Trading)         │
                              │                     │
                              └──────────┬──────────┘
                                         │
                          ┌──────────────┴──────────────┐
                          │                             │
                          ▼                             ▼
                ┌─────────────────┐           ┌─────────────────┐
                │                 │           │                 │
                │   SETTLEMENT    │           │   CERTIFICATION │ ◄──── Process 4
                │   (Payments)    │           │   (ERC)         │
                │                 │           │                 │
                └─────────────────┘           └─────────────────┘
```

---

## 2. Process 1: User Onboarding

### 2.1 Prosumer Registration Flow

```
┌────────────────────────────────────────────────────────────────────────────────────┐
│                    PROSUMER REGISTRATION - SWIMLANE DIAGRAM                        │
└────────────────────────────────────────────────────────────────────────────────────┘


    PROSUMER          │   FRONTEND        │    BACKEND         │    BLOCKCHAIN
                      │                   │                    │
   ┌───────┐          │                   │                    │
   │ Start │          │                   │                    │
   └───┬───┘          │                   │                    │
       │              │                   │                    │
       │ Connect      │                   │                    │
       │ Wallet       │                   │                    │
       ▼              │                   │                    │
   ┌───────────┐      │                   │                    │
   │ Phantom/  │──────│─► Wallet Connect  │                    │
   │ Solflare  │      │   Request         │                    │
   └───────────┘      │      │            │                    │
       │              │      ▼            │                    │
       │              │ ┌───────────┐     │                    │
       │ ◄────────────│─│ Get Wallet│     │                    │
       │              │ │ Address   │     │                    │
       │              │ └───────────┘     │                    │
       │              │                   │                    │
       │ Fill Form    │                   │                    │
       │ (Type, Name) │                   │                    │
       ▼              │                   │                    │
   ┌───────────┐      │                   │                    │
   │ Submit    │──────│─────────────────► │ Validate Input     │
   │ Registration     │                   │      │             │
   └───────────┘      │                   │      ▼             │
       │              │                   │ ┌───────────┐      │
       │              │                   │ │ Check     │      │
       │              │                   │ │ Duplicate │      │
       │              │                   │ └─────┬─────┘      │
       │              │                   │       │            │
       │              │                   │       ▼            │
       │              │                   │ Build TX ──────────│─► Create User PDA
       │              │                   │       │            │        │
       │              │                   │       │            │        ▼
       │              │                   │       │            │   ┌───────────┐
       │              │                   │       │            │   │ Store     │
       │              │                   │       │            │   │ On-chain  │
       │              │                   │       │            │   └─────┬─────┘
       │              │                   │       │            │         │
       │              │                   │ ◄─────│────────────│─────────┘
       │              │                   │       │            │   TX Signature
       │              │                   │       ▼            │
       │              │                   │ ┌───────────┐      │
       │              │                   │ │ Save to   │      │
       │              │                   │ │ PostgreSQL│      │
       │              │                   │ └─────┬─────┘      │
       │              │                   │       │            │
       │ ◄────────────│───────────────────│───────┘            │
       │              │  Success Response │                    │
       ▼              │                   │                    │
   ┌───────┐          │                   │                    │
   │  End  │          │                   │                    │
   └───────┘          │                   │                    │
```

### 2.2 Meter Registration Flow

```
┌────────────────────────────────────────────────────────────────────────────────────┐
│                     METER REGISTRATION - SWIMLANE DIAGRAM                          │
└────────────────────────────────────────────────────────────────────────────────────┘


    PROSUMER          │   BACKEND         │    REGISTRY        │    BLOCKCHAIN
                      │                   │    PROGRAM         │
   ┌───────┐          │                   │                    │
   │ Start │          │                   │                    │
   └───┬───┘          │                   │                    │
       │              │                   │                    │
       │ Submit Meter │                   │                    │
       │ Details      │                   │                    │
       ▼              │                   │                    │
   ┌───────────┐      │                   │                    │
   │ Meter ID  │      │                   │                    │
   │ Location  │──────│─► Validate       │                    │
   │ Type      │      │      │           │                    │
   └───────────┘      │      ▼           │                    │
       │              │ ┌───────────┐    │                    │
       │              │ │ Verify    │    │                    │
       │              │ │ User PDA  │    │                    │
       │              │ └─────┬─────┘    │                    │
       │              │       │          │                    │
       │              │       ▼          │                    │
       │              │ Build TX ────────│─► register_meter()│
       │              │       │          │        │          │
       │              │       │          │        ▼          │
       │              │       │          │ ┌───────────┐     │
       │              │       │          │ │ Create    │     │
       │              │       │          │ │ Meter PDA │─────│─► Store On-chain
       │              │       │          │ └─────┬─────┘     │        │
       │              │       │          │       │           │        │
       │              │       │          │       ▼           │        │
       │              │       │          │ ┌───────────┐     │        │
       │              │       │          │ │ Link to   │     │        │
       │              │       │          │ │ User PDA  │     │        │
       │              │       │          │ └─────┬─────┘     │        │
       │              │       │          │       │           │        │
       │              │ ◄─────│──────────│───────┘           │◄───────┘
       │              │       │          │                   │ TX Confirmed
       │              │       ▼          │                   │
       │              │ ┌───────────┐    │                   │
       │              │ │ Update DB │    │                   │
       │              │ └─────┬─────┘    │                   │
       │              │       │          │                   │
       │ ◄────────────│───────┘          │                   │
       │              │ Meter Registered │                   │
       ▼              │                   │                   │
   ┌───────┐          │                   │                   │
   │  End  │          │                   │                   │
   └───────┘          │                   │                   │
```

---

## 3. Process 2: Energy Management

### 3.1 Energy Production Recording

```
┌────────────────────────────────────────────────────────────────────────────────────┐
│                    ENERGY RECORDING - SWIMLANE DIAGRAM                             │
└────────────────────────────────────────────────────────────────────────────────────┘


    SMART METER       │   API GATEWAY     │    BACKEND         │    BLOCKCHAIN
                      │                   │                    │
   ┌───────┐          │                   │                    │
   │ Start │          │                   │                    │
   └───┬───┘          │                   │                    │
       │              │                   │                    │
       │ Generate     │                   │                    │
       │ Reading      │                   │                    │
       ▼              │                   │                    │
   ┌───────────┐      │                   │                    │
   │ Measure   │      │                   │                    │
   │ kWh Prod  │      │                   │                    │
   │ kWh Cons  │      │                   │                    │
   └─────┬─────┘      │                   │                    │
         │            │                   │                    │
         │ Sign       │                   │                    │
         │ (Ed25519)  │                   │                    │
         ▼            │                   │                    │
   ┌───────────┐      │                   │                    │
   │ Create    │      │                   │                    │
   │ Signature │      │                   │                    │
   └─────┬─────┘      │                   │                    │
         │            │                   │                    │
         │ HTTP POST  │                   │                    │
         ▼            │                   │                    │
   ┌───────────┐      │                   │                    │
   │ Send      │──────│─► Receive        │                    │
   │ Reading   │      │      │           │                    │
   └───────────┘      │      ▼           │                    │
         │            │ ┌───────────┐    │                    │
         │            │ │ Verify    │    │                    │
         │            │ │ Signature │    │                    │
         │            │ └─────┬─────┘    │                    │
         │            │       │          │                    │
         │            │       ▼          │                    │
         │            │ ┌───────────┐    │                    │
         │            │ │ Validate  │    │                    │
         │            │ │ • Age     │    │                    │
         │            │ │ • Dupe    │    │                    │
         │            │ │ • Limits  │    │                    │
         │            │ └─────┬─────┘    │                    │
         │            │       │          │                    │
         │            │       ▼          │                    │
         │            │ Forward ─────────│─► Store Reading    │
         │            │       │          │      │             │
         │            │       │          │      ▼             │
         │            │       │          │ ┌───────────┐      │
         │            │       │          │ │ Insert    │      │
         │            │       │          │ │ minted=F  │      │
         │            │       │          │ └─────┬─────┘      │
         │            │       │          │       │            │
         │            │       │          │       ▼            │
         │            │       │          │ Update Meter ──────│─► submit_reading()
         │            │       │          │ PDA On-chain       │        │
         │            │       │          │       │            │        │
         │            │ ◄─────│──────────│───────┘            │◄───────┘
         │            │       │          │                    │
         │ ◄──────────│───────┘          │                    │
         │            │  200 OK          │                    │
         ▼            │                   │                    │
   ┌───────┐          │                   │                    │
   │  End  │          │                   │                    │
   └───────┘          │                   │                    │
```

### 3.2 Token Minting Process

```
┌────────────────────────────────────────────────────────────────────────────────────┐
│                      TOKEN MINTING - SWIMLANE DIAGRAM                              │
└────────────────────────────────────────────────────────────────────────────────────┘


    POLLING SVC       │   REGISTRY        │   ENERGY TOKEN     │    SPL TOKEN
                      │   PROGRAM         │   PROGRAM          │    PROGRAM
   ┌───────┐          │                   │                    │
   │ Start │          │                   │                    │
   │(Timer)│          │                   │                    │
   └───┬───┘          │                   │                    │
       │              │                   │                    │
       │ Query        │                   │                    │
       │ Unminted     │                   │                    │
       ▼              │                   │                    │
   ┌───────────┐      │                   │                    │
   │ SELECT    │      │                   │                    │
   │ WHERE     │      │                   │                    │
   │ minted=F  │      │                   │                    │
   └─────┬─────┘      │                   │                    │
         │            │                   │                    │
         │ For each   │                   │                    │
         │ reading    │                   │                    │
         ▼            │                   │                    │
   ┌───────────┐      │                   │                    │
   │ Batch     │      │                   │                    │
   │ Process   │      │                   │                    │
   │ (up to 50)│      │                   │                    │
   └─────┬─────┘      │                   │                    │
         │            │                   │                    │
         │ Call TX    │                   │                    │
         ▼            │                   │                    │
   ┌───────────┐      │                   │                    │
   │ settle_   │──────│─► Calculate      │                    │
   │ meter_    │      │   Unsettled      │                    │
   │ balance() │      │      │           │                    │
   └───────────┘      │      ▼           │                    │
         │            │ ┌───────────┐    │                    │
         │            │ │ current - │    │                    │
         │            │ │ settled = │    │                    │
         │            │ │ new_mint  │    │                    │
         │            │ └─────┬─────┘    │                    │
         │            │       │          │                    │
         │            │       │ CPI      │                    │
         │            │       ▼          │                    │
         │            │ mint_from_ ──────│─► Mint Tokens     │
         │            │ production()     │      │             │
         │            │       │          │      ▼             │
         │            │       │          │ ┌───────────┐      │
         │            │       │          │ │ Create    │      │
         │            │       │          │ │ Mint IX   │──────│─► SPL Mint
         │            │       │          │ └───────────┘      │      │
         │            │       │          │      │             │      │
         │            │       │          │ ◄────│─────────────│──────┘
         │            │       │          │      │             │ Tokens Created
         │            │       │          │      ▼             │
         │            │       │          │ ┌───────────┐      │
         │            │       │          │ │ Transfer  │      │
         │            │       │          │ │ to User   │      │
         │            │       │          │ └─────┬─────┘      │
         │            │       │          │       │            │
         │            │ ◄─────│──────────│───────┘            │
         │            │       │          │                    │
         │ ◄──────────│───────┘          │                    │
         │            │ TX Signature     │                    │
         │            │                   │                    │
         ▼            │                   │                    │
   ┌───────────┐      │                   │                    │
   │ Update DB │      │                   │                    │
   │ minted=T  │      │                   │                    │
   │ tx_sig    │      │                   │                    │
   └─────┬─────┘      │                   │                    │
         │            │                   │                    │
         ▼            │                   │                    │
   ┌───────┐          │                   │                    │
   │  End  │          │                   │                    │
   └───────┘          │                   │                    │
```

---

## 4. Process 3: Marketplace Trading

### 4.1 Create Sell Order

```
┌────────────────────────────────────────────────────────────────────────────────────┐
│                    CREATE SELL ORDER - SWIMLANE DIAGRAM                            │
└────────────────────────────────────────────────────────────────────────────────────┘


    PROSUMER          │   FRONTEND        │    TRADING         │    ESCROW
                      │                   │    PROGRAM         │
   ┌───────┐          │                   │                    │
   │ Start │          │                   │                    │
   └───┬───┘          │                   │                    │
       │              │                   │                    │
       │ Enter Order  │                   │                    │
       │ Details      │                   │                    │
       ▼              │                   │                    │
   ┌───────────┐      │                   │                    │
   │ Amount    │      │                   │                    │
   │ Price     │      │                   │                    │
   │ (Optional │      │                   │                    │
   │  ERC)     │      │                   │                    │
   └─────┬─────┘      │                   │                    │
         │            │                   │                    │
         │ Submit     │                   │                    │
         ▼            │                   │                    │
   ┌───────────┐      │                   │                    │
   │ Sign TX   │──────│─► Validate       │                    │
   └───────────┘      │      │           │                    │
         │            │      ▼           │                    │
         │            │ ┌───────────┐    │                    │
         │            │ │ Check     │    │                    │
         │            │ │ Balance   │    │                    │
         │            │ └─────┬─────┘    │                    │
         │            │       │          │                    │
         │            │       ▼          │                    │
         │            │ Build TX ────────│─► create_order()  │
         │            │       │          │      │             │
         │            │       │          │      ▼             │
         │            │       │          │ ┌───────────┐      │
         │            │       │          │ │ Validate  │      │
         │            │       │          │ │ ERC (opt) │      │
         │            │       │          │ └─────┬─────┘      │
         │            │       │          │       │            │
         │            │       │          │       ▼            │
         │            │       │          │ ┌───────────┐      │
         │            │       │          │ │ Create    │      │
         │            │       │          │ │ Order PDA │      │
         │            │       │          │ └─────┬─────┘      │
         │            │       │          │       │            │
         │            │       │          │       ▼            │
         │            │       │          │ Lock Tokens ───────│─► Transfer to
         │            │       │          │       │            │   Escrow PDA
         │            │       │          │       │            │      │
         │            │       │          │ ◄─────│────────────│──────┘
         │            │       │          │       │            │
         │            │       │          │       ▼            │
         │            │       │          │ ┌───────────┐      │
         │            │       │          │ │ Emit      │      │
         │            │       │          │ │ OrderCreated│    │
         │            │       │          │ └─────┬─────┘      │
         │            │       │          │       │            │
         │            │ ◄─────│──────────│───────┘            │
         │            │       │          │                    │
         │ ◄──────────│───────┘          │                    │
         │            │ Order Created    │                    │
         ▼            │                   │                    │
   ┌───────┐          │                   │                    │
   │  End  │          │                   │                    │
   └───────┘          │                   │                    │
```

### 4.2 Match Order (Execute Trade)

```
┌────────────────────────────────────────────────────────────────────────────────────┐
│                     MATCH ORDER - SWIMLANE DIAGRAM                                 │
└────────────────────────────────────────────────────────────────────────────────────┘


    CONSUMER          │   TRADING         │    ESCROW          │    SELLER
                      │   PROGRAM         │                    │    WALLET
   ┌───────┐          │                   │                    │
   │ Start │          │                   │                    │
   └───┬───┘          │                   │                    │
       │              │                   │                    │
       │ Select Order │                   │                    │
       │ from Book    │                   │                    │
       ▼              │                   │                    │
   ┌───────────┐      │                   │                    │
   │ View      │      │                   │                    │
   │ Order #1  │      │                   │                    │
   │ 10 kWh    │      │                   │                    │
   │ @ 3 GRX   │      │                   │                    │
   └─────┬─────┘      │                   │                    │
         │            │                   │                    │
         │ Accept     │                   │                    │
         │ Order      │                   │                    │
         ▼            │                   │                    │
   ┌───────────┐      │                   │                    │
   │ Sign TX   │──────│─► match_order()  │                    │
   └───────────┘      │      │           │                    │
         │            │      ▼           │                    │
         │            │ ┌───────────┐    │                    │
         │            │ │ Validate  │    │                    │
         │            │ │ • Active  │    │                    │
         │            │ │ • NotSelf │    │                    │
         │            │ │ • Balance │    │                    │
         │            │ └─────┬─────┘    │                    │
         │            │       │          │                    │
         │            │       │ ATOMIC   │                    │
         │            │       │ START    │                    │
         │            │       ▼          │                    │
         │            │ ╔═════════════╗  │                    │
         │            │ ║ Phase 1:    ║  │                    │
         │            │ ║ Transfer    ║──│─► Release Tokens  │
         │            │ ║ Tokens      ║  │   from Escrow     │
         │            │ ╚══════╤══════╝  │      │            │
         │            │        │         │      ▼            │
         │            │        │         │ Transfer to ──────│─► Buyer gets
         │ ◄──────────│────────│─────────│ Consumer          │   GRID tokens
         │ GRID tokens│        │         │                   │
         │            │        │         │                    │
         │            │ ╔═════════════╗  │                    │
         │            │ ║ Phase 2:    ║  │                    │
         │ ──────────►│─║ Transfer    ║  │                    │
         │ GRX payment│ ║ Payment     ║  │                    │
         │            │ ╚══════╤══════╝  │                    │
         │            │        │         │                    │
         │            │        │         │                    │   Seller gets
         │            │ Transfer GRX ────│────────────────────│─► GRX payment
         │            │        │         │                    │      │
         │            │        │         │                    │      │
         │            │ ╔═════════════╗  │                    │      │
         │            │ ║ Phase 3:    ║  │                    │      │
         │            │ ║ Update      ║  │                    │      │
         │            │ ║ Order       ║  │                    │      │
         │            │ ║ Status      ║  │                    │      │
         │            │ ╚══════╤══════╝  │                    │      │
         │            │        │         │                    │      │
         │            │        │ ATOMIC  │                    │      │
         │            │        │ END     │                    │      │
         │            │        ▼         │                    │      │
         │            │ ┌───────────┐    │                    │      │
         │            │ │ Emit      │    │                    │      │
         │            │ │TradeExec'd│    │                    │      │
         │            │ └─────┬─────┘    │                    │      │
         │            │       │          │                    │      │
         │ ◄──────────│───────┘          │                    │◄─────┘
         │            │ Trade Complete   │                    │
         ▼            │                   │                    │
   ┌───────┐          │                   │                    │
   │  End  │          │                   │                    │
   └───────┘          │                   │                    │
```

---

## 5. Process 4: Certification

### 5.1 ERC Certificate Issuance

```
┌────────────────────────────────────────────────────────────────────────────────────┐
│                   ERC CERTIFICATE ISSUANCE - SWIMLANE DIAGRAM                      │
└────────────────────────────────────────────────────────────────────────────────────┘


    PROSUMER          │   GOVERNANCE      │    REGISTRY        │    BLOCKCHAIN
                      │   PROGRAM         │    PROGRAM         │
   ┌───────┐          │                   │                    │
   │ Start │          │                   │                    │
   └───┬───┘          │                   │                    │
       │              │                   │                    │
       │ Request ERC  │                   │                    │
       │ Certificate  │                   │                    │
       ▼              │                   │                    │
   ┌───────────┐      │                   │                    │
   │ Energy    │      │                   │                    │
   │ Amount    │──────│─► issue_erc()    │                    │
   │ Source    │      │      │           │                    │
   └───────────┘      │      ▼           │                    │
         │            │ ┌───────────┐    │                    │
         │            │ │ Verify    │    │                    │
         │            │ │ Production│────│─► Query Meter PDA │
         │            │ └─────┬─────┘    │      │             │
         │            │       │          │      ▼             │
         │            │       │          │ ┌───────────┐      │
         │            │       │          │ │ Check     │      │
         │            │       │          │ │ claimed_  │      │
         │            │       │          │ │ erc_gen   │      │
         │            │       │          │ └─────┬─────┘      │
         │            │       │          │       │            │
         │            │       │          │ Verify Amount      │
         │            │ ◄─────│──────────│───────┘            │
         │            │       │          │                    │
         │            │       ▼          │                    │
         │            │ ┌───────────┐    │                    │
         │            │ │ Create    │    │                    │
         │            │ │ ERC PDA   │────│────────────────────│─► Store On-chain
         │            │ └─────┬─────┘    │                    │      │
         │            │       │          │                    │      │
         │            │       ▼          │                    │      │
         │            │ ┌───────────┐    │                    │      │
         │            │ │ Update    │────│─► Update Meter     │      │
         │            │ │ claimed_  │    │   PDA              │      │
         │            │ │ erc_gen   │    │                    │      │
         │            │ └─────┬─────┘    │                    │      │
         │            │       │          │                    │      │
         │            │       ▼          │                    │      │
         │            │ ┌───────────┐    │                    │      │
         │            │ │ Status:   │    │                    │      │
         │            │ │ PENDING   │    │                    │      │
         │            │ └─────┬─────┘    │                    │      │
         │            │       │          │                    │      │
         │ ◄──────────│───────┘          │                    │◄─────┘
         │            │ Certificate ID   │                    │
         ▼            │                   │                    │
   ┌───────┐          │                   │                    │
   │  End  │          │                   │                    │
   └───────┘          │                   │                    │
```

### 5.2 ERC Validation for Trading

```
┌────────────────────────────────────────────────────────────────────────────────────┐
│                   ERC VALIDATION FOR TRADING - SWIMLANE DIAGRAM                    │
└────────────────────────────────────────────────────────────────────────────────────┘


    PROSUMER          │   GOVERNANCE      │    TRADING         │    BLOCKCHAIN
                      │   PROGRAM         │    PROGRAM         │
   ┌───────┐          │                   │                    │
   │ Start │          │                   │                    │
   └───┬───┘          │                   │                    │
       │              │                   │                    │
       │ Request      │                   │                    │
       │ Validation   │                   │                    │
       ▼              │                   │                    │
   ┌───────────┐      │                   │                    │
   │ ERC ID    │──────│─► validate_erc() │                    │
   └───────────┘      │      │           │                    │
         │            │      ▼           │                    │
         │            │ ┌───────────┐    │                    │
         │            │ │ Check     │    │                    │
         │            │ │ Status    │    │                    │
         │            │ │ = PENDING │    │                    │
         │            │ └─────┬─────┘    │                    │
         │            │       │          │                    │
         │            │       ▼          │                    │
         │            │ ┌───────────┐    │                    │
         │            │ │ Verify    │    │                    │
         │            │ │ Expiry    │    │                    │
         │            │ │ Date      │    │                    │
         │            │ └─────┬─────┘    │                    │
         │            │       │          │                    │
         │            │       ▼          │                    │
         │            │ ┌───────────┐    │                    │
         │            │ │ Set       │────│────────────────────│─► Update On-chain
         │            │ │validated_ │    │                    │
         │            │ │for_trading│    │                    │
         │            │ │ = true    │    │                    │
         │            │ └─────┬─────┘    │                    │
         │            │       │          │                    │
         │            │       ▼          │                    │
         │            │ ┌───────────┐    │                    │
         │            │ │ Status:   │    │                    │
         │            │ │ VALID     │    │                    │
         │            │ └─────┬─────┘    │                    │
         │            │       │          │                    │
         │            │       │          │                    │
         │            │       │ LATER:   │                    │
         │            │       │ Trading  │                    │
         │            │       ▼          │                    │
         │            │  ─ ─ ─ ─ ─ ─ ─ ─►│ Create Order      │
         │            │                  │ with ERC          │
         │            │                  │      │             │
         │            │                  │      ▼             │
         │            │                  │ ┌───────────┐      │
         │            │                  │ │ Validate  │      │
         │            │                  │ │ • VALID   │      │
         │            │                  │ │ • NotExp  │      │
         │            │                  │ │ • ForTrade│      │
         │            │                  │ │ • Amount  │      │
         │            │                  │ └─────┬─────┘      │
         │            │                  │       │            │
         │ ◄──────────│──────────────────│───────┘            │
         │            │ ERC Validated    │                    │
         ▼            │                   │                    │
   ┌───────┐          │                   │                    │
   │  End  │          │                   │                    │
   └───────┘          │                   │                    │
```

---

## 6. Complete End-to-End Flow

### 6.1 Daily Trading Cycle

```
┌────────────────────────────────────────────────────────────────────────────────────┐
│                     COMPLETE DAILY TRADING CYCLE                                   │
└────────────────────────────────────────────────────────────────────────────────────┘


TIME        PROSUMER              PLATFORM              CONSUMER
────        ────────              ────────              ────────

06:00 AM    ┌─────────────┐
            │ Solar Start │
            │ Production  │
            └──────┬──────┘
                   │
08:00 AM           │       ┌──────────────────┐
                   ▼       │                  │
            ┌─────────────┐│                  │
            │ Meter       ││ Process Reading  │
            │ Reading #1  ││ Store + Update   │
            │ 5 kWh       │└──────────────────┘
            └─────────────┘
                   │
                   ▼
            ┌─────────────┐
            │ Surplus:    │
            │ 3 kWh       │
            └──────┬──────┘
                   │
10:00 AM           │       ┌──────────────────┐
                   ▼       │                  │
            ┌─────────────┐│ Polling Service  │
            │ Meter       ││ Detects Unminted │
            │ Reading #2  │└────────┬─────────┘
            │ 10 kWh      │         │
            └─────────────┘         ▼
                   │       ┌──────────────────┐
                   │       │ Mint 11 GRID     │
                   │       │ (3+8 surplus)    │
                   │       └──────────────────┘
                   │
12:00 PM    ┌──────┴──────┐
            │ Check       │
            │ Balance:    │
            │ 11 GRID     │
            └──────┬──────┘
                   │
            ┌──────┴──────┐
            │ Create      │
            │ Sell Order  │
            │ 8 GRID      │
            │ @ 3 GRX/kWh │
            └──────┬──────┘
                   │
                   ▼
                   │       ┌──────────────────┐
                   │       │ Order Active     │
                   │       │ in Order Book    │
                   │       └────────┬─────────┘
                   │                │
01:00 PM           │                │       ┌─────────────┐
                   │                │       │ Browse      │
                   │                │◄──────│ Order Book  │
                   │                │       └─────────────┘
                   │                │              │
                   │                │       ┌──────┴──────┐
                   │                │       │ Select      │
                   │                │       │ 8 GRID      │
                   │                │       │ @ 3 GRX     │
                   │                │       └──────┬──────┘
                   │                │              │
                   │                │       ┌──────┴──────┐
                   │       ┌────────│───────│ Match Order │
                   │       │        │       │ (Accept)    │
                   │       │        │       └─────────────┘
                   │       │        │
                   │       ▼        │
                   │ ┌────────────────────┐
                   │ │ ATOMIC SETTLEMENT  │
                   │ │ • Escrow → Buyer   │
                   │ │ • GRX → Seller     │
                   │ │ • Status: FILLED   │
                   │ └────────┬───────────┘
                   │          │
01:05 PM    ┌──────┴──────┐   │       ┌─────────────┐
            │ Received:   │   │       │ Received:   │
            │ +24 GRX     │   │       │ +8 GRID     │
            │ (8 × 3)     │   │       │ (Energy)    │
            └─────────────┘   │       └─────────────┘
                              │
                   ▼          │
04:00 PM    ┌─────────────┐   │
            │ More        │   │
            │ Production  │   │
            │ Create new  │   │
            │ orders...   │   │
            └─────────────┘   │
                              │
06:00 PM           ▼          │
            ┌─────────────┐   │
            │ End of Day  │   │
            │ Balance:    │   │
            │ 3 GRID      │   │
            │ 24 GRX      │   │
            └─────────────┘   │


DAILY SUMMARY:
═══════════════════════════════════════════════════════════════════════════════════

Prosumer:                           Consumer:
├─ Produced: 20 kWh                ├─ Purchased: 8 kWh
├─ Consumed: 9 kWh                 ├─ Spent: 24 GRX
├─ Surplus: 11 kWh                 └─ Got: Green energy
├─ Minted: 11 GRID
├─ Sold: 8 GRID
├─ Remaining: 3 GRID
└─ Earned: 24 GRX
```

---

## 7. Error Handling Flows

### 7.1 Transaction Failure Recovery

```
┌────────────────────────────────────────────────────────────────────────────────────┐
│                  TRANSACTION FAILURE RECOVERY FLOW                                 │
└────────────────────────────────────────────────────────────────────────────────────┘


    USER              │   BACKEND         │    BLOCKCHAIN      │    RECOVERY
                      │                   │                    │
   ┌───────┐          │                   │                    │
   │ Action│          │                   │                    │
   └───┬───┘          │                   │                    │
       │              │                   │                    │
       │ Submit TX    │                   │                    │
       ▼              │                   │                    │
   ┌───────────┐      │                   │                    │
   │ Sign &    │──────│─► Process TX     │                    │
   │ Send      │      │      │           │                    │
   └───────────┘      │      ▼           │                    │
       │              │ ┌───────────┐    │                    │
       │              │ │ Submit to │────│─► TX Execution    │
       │              │ │ Solana    │    │      │             │
       │              │ └───────────┘    │      ▼             │
       │              │       │          │ ┌───────────┐      │
       │              │       │          │ │   FAIL    │      │
       │              │       │          │ │ (Network/ │      │
       │              │       │          │ │  Timeout) │      │
       │              │       │          │ └─────┬─────┘      │
       │              │       │          │       │            │
       │              │ ◄─────│──────────│───────┘            │
       │              │       │          │ Error Response     │
       │              │       ▼          │                    │
       │              │ ┌───────────┐    │                    │ ┌───────────┐
       │              │ │ Log Error │────│────────────────────│─│ Store in  │
       │              │ └─────┬─────┘    │                    │ │ Retry Q   │
       │              │       │          │                    │ └─────┬─────┘
       │              │       ▼          │                    │       │
       │              │ ┌───────────┐    │                    │       │
       │              │ │ Check     │    │                    │       │
       │              │ │ Retry     │    │                    │       │
       │              │ │ Count     │    │                    │       │
       │              │ └─────┬─────┘    │                    │       │
       │              │       │          │                    │       │
       │              │       │ < 3      │                    │       │
       │              │       ▼          │                    │       │
       │              │ ┌───────────┐    │                    │       │
       │              │ │ Wait      │────│────────────────────│───────┘
       │              │ │ (Exp      │    │                    │ Retry Trigger
       │              │ │ Backoff)  │    │                    │
       │              │ └─────┬─────┘    │                    │
       │              │       │          │                    │
       │              │       ▼          │                    │
       │              │ Retry TX ────────│─► TX Execution    │
       │              │       │          │      │             │
       │              │       │          │      ▼             │
       │              │       │          │ ┌───────────┐      │
       │              │       │          │ │  SUCCESS  │      │
       │              │       │          │ └─────┬─────┘      │
       │              │       │          │       │            │
       │              │ ◄─────│──────────│───────┘            │
       │              │       │          │                    │
       │ ◄────────────│───────┘          │                    │
       │              │ Success          │                    │
       ▼              │                   │                    │
   ┌───────┐          │                   │                    │
   │  End  │          │                   │                    │
   └───────┘          │                   │                    │


RETRY POLICY:
═══════════════════════════════════════════════════════════════════════════════════
• Max Retries: 3
• Backoff: Exponential (1s, 2s, 4s)
• After Max: Alert admin + notify user
• Idempotent: Check TX signature before retry
```

---

## 8. Document Navigation

| Previous | Current | Next |
|----------|---------|------|
| [05-TOKEN-ECONOMICS.md](./05-TOKEN-ECONOMICS.md) | **06-PROCESS-FLOWS.md** | [07-SECURITY-ANALYSIS.md](./07-SECURITY-ANALYSIS.md) |

---

**Document Version**: 1.0  
**Last Updated**: November 2024  
**Status**: Complete
